"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.version = exports.initGlobalStore = exports.createStore = exports.globalMixin = exports.injectStaff = exports.mixinMainProcess = void 0;
var mixin_1 = require("./mixin");
var store_1 = require("./store");
var version_1 = require("./version");
function hackPageBuilder() {
    var nativePage = Page;
    Page = function (options) {
        nativePage(mixinMainProcess(options));
    };
}
function hackComponentBuilder() {
    var nativeComponent = Component;
    Component = function (options) {
        nativeComponent(mixinMainProcess(options, 1));
    };
}
function mixinMainProcess(options, type) {
    if (type === void 0) { type = 0; }
    if (!options.data) {
        options.data = {};
    }
    var storeTool = {};
    options = mixin_1._mixinGlobal({ options: options, type: type, storeTool: storeTool });
    options = mixin_1.mixinCurrent({ options: options, type: type, storeTool: storeTool });
    store_1.initStoreHacker({ options: options, type: type, storeTool: storeTool });
    return options;
}
exports.mixinMainProcess = mixinMainProcess;
function main() {
    hackPageBuilder();
    hackComponentBuilder();
    if (typeof wx !== 'undefined') {
        injectStaff(wx);
    }
    else if (typeof qq !== 'undefined') {
        injectStaff(qq);
    }
}
main();
function injectStaff(target) {
    target.mixin = mixin_1._globalMixin;
    target.createStore = store_1._createStore;
    target.initGlobalStore = store_1._initGlobalStore;
    target.mpMixinVersion = version_1.default;
}
exports.injectStaff = injectStaff;
exports.globalMixin = mixin_1._globalMixin;
exports.createStore = store_1._createStore;
exports.initGlobalStore = store_1._initGlobalStore;
exports.version = version_1.default;
var mpMixin = {
    globalMixin: exports.globalMixin,
    createStore: exports.createStore,
    initGlobalStore: exports.initGlobalStore,
    version: exports.version,
    injectStaff: injectStaff,
};
exports.default = {
    globalMixin: exports.globalMixin,
    createStore: exports.createStore,
    initGlobalStore: exports.initGlobalStore,
    version: exports.version,
    injectStaff: injectStaff,
    default: mpMixin,
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJpbmRleC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFVQSxpQ0FBaUU7QUFDakUsaUNBQXdFO0FBRXhFLHFDQUFpQztBQVVqQyxTQUFTLGVBQWU7SUFDcEIsSUFBTSxVQUFVLEdBQUcsSUFBSSxDQUFDO0lBQ3hCLElBQUksR0FBRyxVQUFVLE9BQW9CO1FBQ2pDLFVBQVUsQ0FBQyxnQkFBZ0IsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDO0lBQzFDLENBQUMsQ0FBQztBQUNOLENBQUM7QUFFRCxTQUFTLG9CQUFvQjtJQUN6QixJQUFNLGVBQWUsR0FBRyxTQUFTLENBQUM7SUFDbEMsU0FBUyxHQUFHLFVBQVUsT0FBeUI7UUFDM0MsZUFBZSxDQUFDLGdCQUFnQixDQUFDLE9BQU8sSUFBd0IsQ0FBQyxDQUFDO0lBQ3RFLENBQUMsQ0FBQztBQUNOLENBQUM7QUFFRCxTQUFnQixnQkFBZ0IsQ0FDNUIsT0FBdUMsRUFDdkMsSUFBb0M7SUFBcEMscUJBQUEsRUFBQSxRQUFvQztJQUVwQyxJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksRUFBRTtRQUFFLE9BQU8sQ0FBQyxJQUFJLEdBQUcsRUFBRSxDQUFDO0tBQUU7SUFDekMsSUFBTSxTQUFTLEdBQVUsRUFBRSxDQUFDO0lBQzVCLE9BQU8sR0FBRyxvQkFBWSxDQUFDLEVBQUMsT0FBTyxTQUFBLEVBQUUsSUFBSSxNQUFBLEVBQUUsU0FBUyxXQUFBLEVBQUMsQ0FBQyxDQUFDO0lBRW5ELE9BQU8sR0FBRyxvQkFBWSxDQUFDLEVBQUMsT0FBTyxTQUFBLEVBQUUsSUFBSSxNQUFBLEVBQUUsU0FBUyxXQUFBLEVBQUMsQ0FBQyxDQUFDO0lBRW5ELHVCQUFlLENBQUMsRUFBQyxPQUFPLFNBQUEsRUFBRSxJQUFJLE1BQUEsRUFBRSxTQUFTLFdBQUEsRUFBQyxDQUFDLENBQUM7SUFFNUMsT0FBTyxPQUFPLENBQUM7QUFDbkIsQ0FBQztBQWJELDRDQWFDO0FBRUQsU0FBUyxJQUFJO0lBQ1QsZUFBZSxFQUFFLENBQUM7SUFDbEIsb0JBQW9CLEVBQUUsQ0FBQztJQUV2QixJQUFJLE9BQU8sRUFBRSxLQUFLLFdBQVcsRUFBRTtRQUMzQixXQUFXLENBQUMsRUFBRSxDQUFDLENBQUM7S0FDbkI7U0FBTSxJQUFJLE9BQU8sRUFBRSxLQUFLLFdBQVcsRUFBRTtRQUNsQyxXQUFXLENBQUMsRUFBRSxDQUFDLENBQUM7S0FDbkI7QUFDTCxDQUFDO0FBRUQsSUFBSSxFQUFFLENBQUM7QUFFUCxTQUFnQixXQUFXLENBQUUsTUFLNUI7SUFDRyxNQUFNLENBQUMsS0FBSyxHQUFHLG9CQUFZLENBQUM7SUFDNUIsTUFBTSxDQUFDLFdBQVcsR0FBRyxvQkFBWSxDQUFDO0lBQ2xDLE1BQU0sQ0FBQyxlQUFlLEdBQUcsd0JBQWdCLENBQUM7SUFDMUMsTUFBTSxDQUFDLGNBQWMsR0FBRyxpQkFBUSxDQUFDO0FBQ3JDLENBQUM7QUFWRCxrQ0FVQztBQUVZLFFBQUEsV0FBVyxHQUFHLG9CQUFZLENBQUM7QUFDM0IsUUFBQSxXQUFXLEdBQUcsb0JBQVksQ0FBQztBQUMzQixRQUFBLGVBQWUsR0FBRyx3QkFBZ0IsQ0FBQztBQUNuQyxRQUFBLE9BQU8sR0FBRyxpQkFBUSxDQUFDO0FBRWhDLElBQU0sT0FBTyxHQUFHO0lBQ1osV0FBVyxxQkFBQTtJQUNYLFdBQVcscUJBQUE7SUFDWCxlQUFlLHlCQUFBO0lBQ2YsT0FBTyxpQkFBQTtJQUNQLFdBQVcsYUFBQTtDQUNkLENBQUM7QUFFRixrQkFBZTtJQUNYLFdBQVcscUJBQUE7SUFDWCxXQUFXLHFCQUFBO0lBQ1gsZUFBZSx5QkFBQTtJQUNmLE9BQU8saUJBQUE7SUFDUCxXQUFXLGFBQUE7SUFDWCxPQUFPLEVBQUUsT0FBTztDQUNuQixDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLypcclxuICogQEF1dGhvcjogdGFja2NoZW5cclxuICogQERhdGU6IDIwMjEtMDUtMDEgMTg6Mjc6MDNcclxuICogQExhc3RFZGl0b3JzOiB0aGVhamFja1xyXG4gKiBATGFzdEVkaXRUaW1lOiAyMDIxLTA1LTExIDIzOjQxOjI0XHJcbiAqIEBGaWxlUGF0aDogXFxtcC1taXhpblxcc3JjXFxpbmRleC50c1xyXG4gKiBARGVzY3JpcHRpb246IENvZGluZyBzb21ldGhpbmdcclxuICovXHJcblxyXG5pbXBvcnQge1RBUkdFVF9UWVBFfSBmcm9tICcuL2NvbnN0YW50JztcclxuaW1wb3J0IHtfZ2xvYmFsTWl4aW4sIG1peGluQ3VycmVudCwgX21peGluR2xvYmFsfSBmcm9tICcuL21peGluJztcclxuaW1wb3J0IHtfY3JlYXRlU3RvcmUsIF9pbml0R2xvYmFsU3RvcmUsIGluaXRTdG9yZUhhY2tlcn0gZnJvbSAnLi9zdG9yZSc7XHJcbmltcG9ydCB7SVBhZ2VPcHRpb24sIElHbG9iYWxNaXhpbkZuLCBJQ3JlYXRlU3RvcmVGbiwgSUluaXRHbG9iYWxTdG9yZUZuLCBJQ29tcG9uZW50T3B0aW9uLCBJSnNvbn0gZnJvbSAnLi90eXBlJztcclxuaW1wb3J0IF92ZXJzaW9uIGZyb20gJy4vdmVyc2lvbic7XHJcblxyXG5kZWNsYXJlIGdsb2JhbCB7XHJcbiAgICBsZXQgUGFnZTogKG9wdGlvbnM6IElQYWdlT3B0aW9uKSA9PiB2b2lkO1xyXG4gICAgbGV0IENvbXBvbmVudDogKG9wdGlvbnM6IElDb21wb25lbnRPcHRpb24pID0+IHZvaWQ7XHJcbiAgICBjb25zdCB3eDogb2JqZWN0O1xyXG4gICAgY29uc3QgcXE6IG9iamVjdDtcclxufVxyXG5cclxuLy8g5rOo5YWl5LiA5Lqb5YWo5bGA5pa55rOVXHJcbmZ1bmN0aW9uIGhhY2tQYWdlQnVpbGRlciAoKSB7XHJcbiAgICBjb25zdCBuYXRpdmVQYWdlID0gUGFnZTtcclxuICAgIFBhZ2UgPSBmdW5jdGlvbiAob3B0aW9uczogSVBhZ2VPcHRpb24pIHtcclxuICAgICAgICBuYXRpdmVQYWdlKG1peGluTWFpblByb2Nlc3Mob3B0aW9ucykpO1xyXG4gICAgfTtcclxufVxyXG5cclxuZnVuY3Rpb24gaGFja0NvbXBvbmVudEJ1aWxkZXIgKCkge1xyXG4gICAgY29uc3QgbmF0aXZlQ29tcG9uZW50ID0gQ29tcG9uZW50O1xyXG4gICAgQ29tcG9uZW50ID0gZnVuY3Rpb24gKG9wdGlvbnM6IElDb21wb25lbnRPcHRpb24pIHtcclxuICAgICAgICBuYXRpdmVDb21wb25lbnQobWl4aW5NYWluUHJvY2VzcyhvcHRpb25zLCBUQVJHRVRfVFlQRS5DT01QT05FTlQpKTtcclxuICAgIH07XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBtaXhpbk1haW5Qcm9jZXNzIChcclxuICAgIG9wdGlvbnM6IElQYWdlT3B0aW9uIHwgSUNvbXBvbmVudE9wdGlvbixcclxuICAgIHR5cGU6IFRBUkdFVF9UWVBFID0gVEFSR0VUX1RZUEUuUEFHRVxyXG4pIHtcclxuICAgIGlmICghb3B0aW9ucy5kYXRhKSB7IG9wdGlvbnMuZGF0YSA9IHt9OyB9XHJcbiAgICBjb25zdCBzdG9yZVRvb2w6IElKc29uID0ge307XHJcbiAgICBvcHRpb25zID0gX21peGluR2xvYmFsKHtvcHRpb25zLCB0eXBlLCBzdG9yZVRvb2x9KTtcclxuXHJcbiAgICBvcHRpb25zID0gbWl4aW5DdXJyZW50KHtvcHRpb25zLCB0eXBlLCBzdG9yZVRvb2x9KTtcclxuXHJcbiAgICBpbml0U3RvcmVIYWNrZXIoe29wdGlvbnMsIHR5cGUsIHN0b3JlVG9vbH0pO1xyXG5cclxuICAgIHJldHVybiBvcHRpb25zO1xyXG59XHJcblxyXG5mdW5jdGlvbiBtYWluICgpIHtcclxuICAgIGhhY2tQYWdlQnVpbGRlcigpO1xyXG4gICAgaGFja0NvbXBvbmVudEJ1aWxkZXIoKTtcclxuICBcclxuICAgIGlmICh0eXBlb2Ygd3ggIT09ICd1bmRlZmluZWQnKSB7XHJcbiAgICAgICAgaW5qZWN0U3RhZmYod3gpO1xyXG4gICAgfSBlbHNlIGlmICh0eXBlb2YgcXEgIT09ICd1bmRlZmluZWQnKSB7XHJcbiAgICAgICAgaW5qZWN0U3RhZmYocXEpO1xyXG4gICAgfVxyXG59XHJcblxyXG5tYWluKCk7XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gaW5qZWN0U3RhZmYgKHRhcmdldDogb2JqZWN0ICYge1xyXG4gIG1peGluPzogSUdsb2JhbE1peGluRm47XHJcbiAgY3JlYXRlU3RvcmU/OiBJQ3JlYXRlU3RvcmVGbjtcclxuICBpbml0R2xvYmFsU3RvcmU/OiBJSW5pdEdsb2JhbFN0b3JlRm47XHJcbiAgbXBNaXhpblZlcnNpb24/OiBzdHJpbmc7XHJcbn0pIHtcclxuICAgIHRhcmdldC5taXhpbiA9IF9nbG9iYWxNaXhpbjtcclxuICAgIHRhcmdldC5jcmVhdGVTdG9yZSA9IF9jcmVhdGVTdG9yZTtcclxuICAgIHRhcmdldC5pbml0R2xvYmFsU3RvcmUgPSBfaW5pdEdsb2JhbFN0b3JlO1xyXG4gICAgdGFyZ2V0Lm1wTWl4aW5WZXJzaW9uID0gX3ZlcnNpb247XHJcbn1cclxuXHJcbmV4cG9ydCBjb25zdCBnbG9iYWxNaXhpbiA9IF9nbG9iYWxNaXhpbjtcclxuZXhwb3J0IGNvbnN0IGNyZWF0ZVN0b3JlID0gX2NyZWF0ZVN0b3JlO1xyXG5leHBvcnQgY29uc3QgaW5pdEdsb2JhbFN0b3JlID0gX2luaXRHbG9iYWxTdG9yZTtcclxuZXhwb3J0IGNvbnN0IHZlcnNpb24gPSBfdmVyc2lvbjtcclxuXHJcbmNvbnN0IG1wTWl4aW4gPSB7XHJcbiAgICBnbG9iYWxNaXhpbixcclxuICAgIGNyZWF0ZVN0b3JlLFxyXG4gICAgaW5pdEdsb2JhbFN0b3JlLFxyXG4gICAgdmVyc2lvbixcclxuICAgIGluamVjdFN0YWZmLFxyXG59O1xyXG5cclxuZXhwb3J0IGRlZmF1bHQge1xyXG4gICAgZ2xvYmFsTWl4aW4sXHJcbiAgICBjcmVhdGVTdG9yZSxcclxuICAgIGluaXRHbG9iYWxTdG9yZSxcclxuICAgIHZlcnNpb24sXHJcbiAgICBpbmplY3RTdGFmZixcclxuICAgIGRlZmF1bHQ6IG1wTWl4aW4sIC8vIOWvueS6juW+ruS/oXRz57yW6K+R55qEIGRlZmF1bHQg55qE5YW85a65XHJcbn07Il19